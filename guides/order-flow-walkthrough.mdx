---
title: "Order Flow Integration Guide"
description: "Production-ready integration guide for implementing the Stable Sea Terminal API"
---

## Overview

This guide provides a comprehensive walkthrough for implementing the Stable Sea Terminal API in production. It covers the complete order flow from authentication to settlement, including security, monitoring, error handling, and best practices.

## Step-by-Step Integration

Follow these steps to implement the complete order flow from organization creation to settlement:

<Steps>
  <Step title="Authentication">
    All API requests require Bearer token authentication. Your API key serves as the bearer token.

    ```bash
    # Test authentication
    curl -X GET "https://api-sandbox.stablesea.xyz/v1/hours-of-operations" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json"
    ```

    <Note>
      Replace `YOUR_API_KEY` with your actual API key. Store this securely and never expose it in client-side code.
    </Note>

  </Step>

  <Step title="Create Organization">
    Create an organization entity to associate with your orders and payment instruments.

    ```bash
    curl -X POST "https://api-sandbox.stablesea.xyz/v1/organizations" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "name": "Test Organization Corp",
        "contact": {
          "email": "contact@testorganization.com",
          "first_name": "John",
          "last_name": "Doe"
        }
      }'
    ```

    **Response:**
    ```json
    {
      "data": {
        "id": "org_01k4qmbcd5efk9zkhv32cqzjhq",
        "name": "Test Organization Corp",
        "contact": {
          "email": "contact@testorganization.com",
          "first_name": "John",
          "last_name": "Doe"
        },
        "status": {
          "current_status": "COMPLIANCE_HOLD",
          "status_history": [
            {
              "status": "COMPLIANCE_HOLD",
              "created_at": "2025-09-09T12:18:40-04:00"
            }
          ]
        },
        "created_at": "2025-09-09T12:18:40-04:00",
        "updated_at": "2025-09-09T12:18:40-04:00"
      }
    }
    ```

    <Tip>
      Save the organization `id` (starts with `org_`) as you'll need it for subsequent API calls. Note that new organizations typically start in `COMPLIANCE_HOLD` status and may need approval before becoming `ACTIVE`.
    </Tip>

  </Step>

  <Step title="Create External Payment Instruments">
    Set up both payin and payout payment methods for your organization.

    **Create Payin Payment Instrument (USDC Solana Address):**
    ```bash
    curl -X POST "https://api-sandbox.stablesea.xyz/v1/organizations/ORGANIZATION_ID/external_payment_instruments" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "alias": "Test Solana Address",
        "currency": "USDC",
        "method": "SOLANA_ADDRESS",
        "details": {
          "address": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
        }
      }'
    ```

    **Create Payout Payment Instrument (COP Bank Account):**
    ```bash
    curl -X POST "https://api-sandbox.stablesea.xyz/v1/organizations/ORGANIZATION_ID/external_payment_instruments" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "alias": "Test COP Bank Account",
        "currency": "COP",
        "method": "COP_BANK_ACCOUNT",
        "details": {
          "bank_account_number": "1234567890",
          "bank_code": "001",
          "account_holder_first_name": "Juan",
          "account_holder_last_name": "Perez",
          "legal_entity_name": "Juan Perez Empresa",
          "doc_type": "CC",
          "doc_id": "901458.6527",
          "physical_address": "Calle 123 #45-67, Bogotá, Colombia",
          "account_type": "savings"
        }
      }'
    ```

    **USDC Solana Address Response:**
    ```json
    {
      "data": {
        "id": "mnyacct_01k4qmv28kefk8mgxje22f360y",
        "alias": "Test Solana Address",
        "currency": "USDC",
        "method": "SOLANA_ADDRESS",
        "status": {
          "current_status": "COMPLIANCE_HOLD",
          "status_history": [
            {
              "status": "COMPLIANCE_HOLD",
              "created_at": "2025-09-09T12:27:14-04:00"
            }
          ]
        },
        "details": {
          "address": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
        }
      }
    }
    ```

    **COP Bank Account Response:**
    ```json
    {
      "data": {
        "id": "mnyacctcop_01k4qmx3fcefkaswg60jq2eafk",
        "alias": "Test COP Bank Account",
        "currency": "COP",
        "method": "COP_BANK_ACCOUNT",
        "status": {
          "current_status": "COMPLIANCE_HOLD",
          "status_history": [
            {
              "status": "COMPLIANCE_HOLD",
              "created_at": "2025-09-09T12:28:21-04:00"
            }
          ]
        },
        "details": {
          "bank_account_number": "1234567890",
          "bank_code": "001",
          "account_holder_first_name": "Juan",
          "account_holder_last_name": "Perez",
          "legal_entity_name": "Juan Perez Empresa",
          "doc_type": "CC",
          "doc_id": "901458.6527",
          "physical_address": "Calle 123 #45-67, Bogotá, Colombia",
          "account_type": "savings"
        }
      }
    }
    ```

    <Warning>
      Payment instruments start in `COMPLIANCE_HOLD` status and may need approval before becoming `ACTIVE`. Store the returned IDs (starting with `mnyacct_` or `mnyacctcop_`) for creating offerings.
    </Warning>

  </Step>

  <Step title="Check Hours of Operation">
    Verify that liquidity providers are operating before creating offerings.

    ```bash
    curl -X GET "https://api-sandbox.stablesea.xyz/v1/hours-of-operations" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json"
    ```

    **Response:**
    ```json
    {
      "data": [
        {
          "liquidity_provider": "ALPHA",
          "payin_currency": "USDC",
          "payout_currency": "COP",
          "hours_of_operation": [
            {
              "open_time_utc": "2025-09-09T13:30:00Z",
              "close_time_utc": "2025-09-09T20:00:00Z"
            },
            {
              "open_time_utc": "2025-09-10T13:30:00Z",
              "close_time_utc": "2025-09-10T20:00:00Z"
            },
            {
              "open_time_utc": "2025-09-11T13:30:00Z",
              "close_time_utc": "2025-09-11T20:00:00Z"
            },
            {
              "open_time_utc": "2025-09-12T13:30:00Z",
              "close_time_utc": "2025-09-12T20:00:00Z"
            }
          ]
        }
      ]
    }
    ```

    <Tip>
      Only create offerings when liquidity providers are within their operating hours for optimal execution.
    </Tip>

  </Step>

  <Step title="Create Offerings">
    Generate available payment corridors and rates for your organization.

    ```bash
    curl -X POST "https://api-sandbox.stablesea.xyz/v1/organizations/ORGANIZATION_ID/offerings" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json"
    ```

    **Response:**
    ```json
    {
      "data": [
        {
          "id": "off_01k4qmyaxsefkargtccm4ycxsf",
          "order_type": "QUOTED",
          "payin": {
            "external_payment_instrument": {
              "id": "mnyacct_01k4qmv28kefk8mgxje22f360y",
              "alias": "Test Solana Address",
              "currency": "USDC",
              "method": "SOLANA_ADDRESS",
              "status": {
                "current_status": "COMPLIANCE_HOLD",
                "status_history": [
                  {
                    "status": "COMPLIANCE_HOLD",
                    "created_at": "2025-09-09T12:27:14-04:00"
                  }
                ]
              },
              "details": {
                "address": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
              }
            },
            "limits": {
              "min": "0.01",
              "max": "100"
            },
            "indicative_cost_tiers": [
              {
                "min": "0.01",
                "max": "1",
                "bps": "75"
              },
              {
                "min": "1.01",
                "max": "25",
                "bps": "70"
              },
              {
                "min": "25.01",
                "max": "100",
                "bps": "60"
              }
            ]
          },
          "payout": {
            "external_payment_instrument": {
              "id": "mnyacctcop_01k4qmx3fcefkaswg60jq2eafk",
              "alias": "Test COP Bank Account",
              "currency": "COP",
              "method": "COP_BANK_ACCOUNT",
              "status": {
                "current_status": "COMPLIANCE_HOLD",
                "status_history": [
                  {
                    "status": "COMPLIANCE_HOLD",
                    "created_at": "2025-09-09T12:28:21-04:00"
                  }
                ]
              },
              "details": {
                "bank_account_number": "1234567890",
                "bank_code": "001",
                "account_holder_first_name": "Juan",
                "account_holder_last_name": "Perez",
                "legal_entity_name": "Juan Perez Empresa",
                "doc_type": "CC",
                "doc_id": "901458.6527",
                "physical_address": "Calle 123 #45-67, Bogotá, Colombia",
                "account_type": "savings"
              }
            }
          },
          "indicative_exchange_rate": "3290.5",
          "current_day_hours_of_operation": {
            "open_utc": "2025-09-09T13:30:00Z",
            "close_utc": "2025-09-09T20:00:00Z"
          },
          "liquidity_provider": "DLOCAL",
          "estimated_settlement_time": "T+0",
          "created_at": "2025-09-09T12:29:01-04:00"
        }
      ]
    }
    ```

    <Note>
      Offerings contain indicative rates and fees. Final rates are locked when creating quotes.
    </Note>

  </Step>

  <Step title="Create Quote">
    Get firm pricing with locked exchange rates and expiration times.

    ```bash
    curl -X POST "https://api-sandbox.stablesea.xyz/v1/organizations/ORGANIZATION_ID/quotes" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "offering_id": "string",
        "payin_amount": "string"
      }'
    ```

    **Response:**
    ```json
    {
      "data": {
        "id": "quo_mno456pqr789",
        "offering_id": "off_789xyz456abc",
        "exchange_rate": "129.45",
        "payin": {
          "total": "1000.00",
          "fee": "15.00",
          "tax": "0.00"
        },
        "payout": {
          "total": "127508.25"
        },
        "submission_expires_at": "2024-01-15T11:00:00Z",
        "funding_expires_at": "2024-01-15T15:00:00Z",
        "created_at": "2024-01-15T10:45:00Z"
      }
    }
    ```

    <Warning>
      Quotes have two expiration times:
      - `submission_expires_at`: Deadline to create an order
      - `funding_expires_at`: Deadline to fund the order after creation
    </Warning>

  </Step>

  <Step title="Create Order">
    Convert your quote into an executable order before expiration.

    ```bash
    curl -X POST "https://api-sandbox.stablesea.xyz/v1/organizations/ORGANIZATION_ID/orders" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json" \
      -H "Idempotency-Key: $(uuidgen)" \
      -d '{
        "quote_id": "string"
      }'
    ```

    **Response:**
    ```json
    {
      "data": {
        "id": "ord_stu789vwx012",
        "quote_id": "quo_mno456pqr789",
        "offering_id": "off_789xyz456abc",
        "reference_number": "SS240115-001",
        "external_reference_id": null,
        "exchange_rate": "129.45",
        "effective_exchange_rate": "129.45",
        "payin": {
          "external_payment_instrument_id": "epi_abc123def456",
          "currency": "USD",
          "method": "BANK_TRANSFER",
          "total": "1000.00",
          "fee": "15.00",
          "tax": "0.00"
        },
        "payout": {
          "external_payment_instrument_id": "epi_def456ghi789",
          "currency": "KES",
          "method": "MOBILE_MONEY"
        },
        "status": {
          "current_status": "STEP_1_AWAITING_FUNDING",
          "status_history": [
            {
              "status": "STEP_1_AWAITING_FUNDING",
              "created_at": "2024-01-15T10:50:00Z"
            }
          ]
        },
        "retry_order_id": null,
        "created_at": "2024-01-15T10:50:00Z",
        "updated_at": "2024-01-15T10:50:00Z"
      }
    }
    ```

    <Tip>
      Use the `Idempotency-Key` header to safely retry order creation without creating duplicates.
    </Tip>

  </Step>

  <Step title="Monitor Order Status">
    Track your order through the complete settlement lifecycle.

    ```bash
    curl -X GET "https://api-sandbox.stablesea.xyz/v1/organizations/ORGANIZATION_ID/orders/ORDER_ID" \
      -H "Authorization: Bearer YOUR_API_KEY" \
      -H "Content-Type: application/json"
    ```

    **Order Status Progression:**
    - `STEP_1_AWAITING_FUNDING` - Waiting for payin funds
    - `STEP_2_FILLING_FX` - Executing foreign exchange
    - `STEP_3_SETTLING_PAYOUT` - Processing payout settlement
    - `STEP_4_COMPLETED` - Order successfully completed

    <Note>
      Poll the order status endpoint periodically to monitor order progress. Consider implementing exponential backoff between polling requests.
    </Note>

  </Step>
</Steps>

## Production Considerations

### API Key Security

- Store API keys in environment variables, not code
- Use different keys for sandbox and production
- Rotate keys regularly for security
- Use secret management services (AWS Secrets Manager, HashiCorp Vault)
- Always use HTTPS/TLS 1.3 for API communications
- Implement proper access controls and audit logging

### Error Handling

```javascript
// Simple retry with exponential backoff
async function apiCallWithRetry(requestFn, maxRetries = 3) {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await requestFn();
    } catch (error) {
      if (attempt === maxRetries || error.status < 500) {
        throw error;
      }
      await new Promise((resolve) =>
        setTimeout(resolve, 1000 * Math.pow(2, attempt))
      );
    }
  }
}
```

### Monitoring

- Track order success rates and settlement times
- Monitor API response times and error rates
- Set up alerts for high error rates or slow responses
- Log all API interactions with correlation IDs
- Use structured logging with JSON format
- Monitor quote-to-order conversion rates
- Track performance by payment method and currency pair
- Set up dashboards for real-time order flow visibility
